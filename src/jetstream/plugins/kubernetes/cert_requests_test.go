package kubernetes

import (
	"net/http/httptest"
	"strings"
	"testing"

	"github.com/labstack/echo"
)

func TestFetchCertAuth(t *testing.T) {

	kubeSpec := &KubernetesSpecification{}

	mockConnectRequet := `'{ "cert": "-----BEGIN CERTIFICATE-----\nMIIDADCCAeigAwIBAgIBAjANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p\na3ViZUNBMB4XDTE4MTAxMTEwMjAzOFoXDTE5MTAxMjEwMjAzOFowMTEXMBUGA1UE\nChMOc3lzdGVtOm1hc3RlcnMxFjAUBgNVBAMTDW1pbmlrdWJlLXVzZXIwggEiMA0G\nCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDxSmOgNFeyV92DNRkDf5SRfY9XxFEY\nlQvgyDragUZBqqShPZdgEvpEZUNnEhkVZbw9Xe1zQLuQnfrDhDs8yjNO1Y5xeKvs\nHBUAdK1kaP2PW1XR7xqDHvHWaCwQYWG+PlkCW385c0l6KWEG9IYEXWdOUClFnOvh\nrA7dS5dyxUbSqBwDRH9c2XCV48sWKfravd/189mbD5+PFOYv+gDQrppSbu3C+cNf\nl/w49t/CPZT8lqVSaAPxs9qJm+JHUEXy7kZvldYlo762wWPzsBhisd5NnkhflhkP\nJIckZ3yyaynGd9be+7okhpTKuI3Qxhy10k1k1sWrbbSYRCnd5jGU7svDAgMBAAGj\nPzA9MA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUH\nAwIwDAYDVR0TAQH/BAIwADANBgkqhkiG9w0BAQsFAAOCAQEAZJKzNHAURBWbkHt5\n60dYLX5xuryOndzLZE59xppu7qt8TerlH7jgRYuRXOT3c2sZHC3ZZRupLYsoCkoo\nZG+r0WCyNJ4Yz6LTXV+rswkD5iKLuKmhGvL99v1xGFoUGsFPnOPBJvgULXi41xe/\nXjffHDhRnjaiXUSdX3tp+CIODpsUO8gMmFKGtMGaayrAU3eex2qWXCda/dL3in9/\n1Bbqd5nIit2A0/NTajQ8Je9V9ls9hPM6v+dI9XevQWaK2Dklqw206YklXmvgQijK\nMJ4mMJRjqMDXBlV8pIKcEH++I2Q3j8zW7yhSnGEc6MliSN3ozdiemyEzJvLGEUfM\nhVtSPw==\n-----END CERTIFICATE-----\n", "key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEA8UpjoDRXslfdgzUZA3+UkX2PV8RRGJUL4Mg62oFGQaqkoT2X\nYBL6RGVDZxIZFWW8PV3tc0C7kJ36w4Q7PMozTtWOcXir7BwVAHStZGj9j1tV0e8a\ngx7x1mgsEGFhvj5ZAlt/OXNJeilhBvSGBF1nTlApRZzr4awO3UuXcsVG0qgcA0R/\nXNlwlePLFin62r3f9fPZmw+fjxTmL/oA0K6aUm7twvnDX5f8OPbfwj2U/JalUmgD\n8bPaiZviR1BF8u5Gb5XWJaO+tsFj87AYYrHeTZ5IX5YZDySHJGd8smspxnfW3vu6\nJIaUyriN0MYctdJNZNbFq220mEQp3eYxlO7LwwIDAQABAoIBAQDHEIwou4YuSHcj\nrEa6sCKt9VyxF/GfyjdGd2q2ojiILHQt4lZkmMOIcdKt0iyHjqtCJZ+kmh8kLHGZ\npBoLCPZTb7RYwSl1XaWl/pyeXk/yWXPwAsdorbrvHHpd+TlebqmYXEwV5ZsVAdZe\nmpWGPFjiLxgdqlygjgalY5vKwB6x4w0vSs7ZQPhBAjM+7kd7eJAEBGeLQ/YQLB/V\n5Bkkr/fOgz+P7WkyAJ/FMbG68+A7gQGy2oXgglul9x9b9dqrCJnMTqd4ComNjNac\nJUjXc0EFxRjN7NGGczxWDEgsWbpc1xZX+m3pD+BtCwpRyrxCsCXl+NYgOMIoQYib\niLPg8l3BAoGBAPPkpLu34SSaARM8MX1lBrGLkI6r9KenLiVMaNyloB1kr3oChBnx\nbzNd2GqisAlBEorUXGd9PZuSjbdF2uqLh/uS/vPA1JfGwkjFDFcrMYWx11XeLs/Q\nf+v1vvd9EJyoL6zB1BHZzVnzqHCl89io4F7ZIw2iJCCcZRb7be9GsnGbAoGBAP1E\nrDwnWP4nW7M0vRXpUdct5POztvHTZh51Ih/w6INC9ZuywxRh2/WLK4fVAD61xYhN\nUGAoSaTC4keghbU/Mf9ikAKw71dOvNGK0Rv4NNVplBVlXarqy8JSxbHrsMSnkI28\n8MgmXvV/6F0e51XYulyXQsjUjBmTWQ53ftVqtaT5AoGBAOoFJhwJIDsimo1+YG5V\nlcqehCKh1KtZuumHG8c8FRqfFdEYwPCzvWOoVJRdblQy4Dvd8JxMi+TPBrQojxom\nsGAwd/ojuNm5mYqBqImrpGUIc/qsqnY1NcmPj6Ghm2L17mjxwy8tseDx71nHoubt\ng/z+lKfsQIYaCtW2g5HoYCipAoGBAM3mpp/A3XjCRqrKlW7a4M4vYZM+59xyIPNi\nBvwwvtb3+PU7v50yccCOBDXJ1QkmfhDxygZiunxYc94Hgqx3VA5r8ug9MFeqi5dP\nY/F5OHrH+rvqTNxHRqAU6uRa2LsH/1073gTaLRkpg58xIKGKMPhVgNYE9mFUiXJZ\nc6PNvR8BAoGAM359YICTjSMbV/J2TmLuf8vz8tYRCyyekHzgkSrjjYFV6j1Q9eXd\nkVEZ+ZamqbFoRlj+YGKmWCL49rSZF16eX/Uw9nahA+rkX/mZhDd9r+TOtzzrqEXI\nTAYewtyda3S92k+NYO3dNdmfKAWXWbsv6T+0AMtzU1d2SZh9lMNZVE0=\n-----END RSA PRIVATE KEY-----\n'"}`

	req := httptest.NewRequest(echo.POST, "/pp/v1/auth/login/cnsi?cert=&certKey=&cnsi_guid=testGuid&connect_type=kube-cert-auth&system_shared=false", strings.NewReader(mockConnectRequet))
	rec := httptest.NewRecorder()
	c := e.NewContext(req, rec)

}

//curl 'https://localhost:4200/pp/v1/auth/login/cnsi?cert=&certKey=&cnsi_guid=qUqP5cyxm6YcTAhz05Hph5gvu9M&connect_type=kube-cert-auth&system_shared=false' -H 'cookie: JSESSIONID=03E471141A85F06FAFA8CB818004BD2E; console-session=MTUzOTM0MjIyOHxCZ3dBQXpFMk5nPT181Yo39700YsNunmkrK6ZVO_8fEqWwSA1k7yXKK-yj73Q=' -H 'origin: https://localhost:4200' -H 'x-xsrf-token: hXqpKIa77uVe/J/HYKkbUr27BGNaoEnWe3rJqG4U8M8=' -H 'accept-language: en-US,en;q=0.9' -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36' -H 'content-type: text/plain' -H 'accept: application/json, text/plain, */*' -H 'referer: https://localhost:4200/endpoints' -H 'authority: localhost:4200' -H 'accept-encoding: gzip, deflate, br' -H 'dnt: 1' --data-binary $'{ "cert": -----BEGIN CERTIFICATE-----\nMIIDADCCAeigAwIBAgIBAjANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p\na3ViZUNBMB4XDTE4MTAxMTEwMjAzOFoXDTE5MTAxMjEwMjAzOFowMTEXMBUGA1UE\nChMOc3lzdGVtOm1hc3RlcnMxFjAUBgNVBAMTDW1pbmlrdWJlLXVzZXIwggEiMA0G\nCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDxSmOgNFeyV92DNRkDf5SRfY9XxFEY\nlQvgyDragUZBqqShPZdgEvpEZUNnEhkVZbw9Xe1zQLuQnfrDhDs8yjNO1Y5xeKvs\nHBUAdK1kaP2PW1XR7xqDHvHWaCwQYWG+PlkCW385c0l6KWEG9IYEXWdOUClFnOvh\nrA7dS5dyxUbSqBwDRH9c2XCV48sWKfravd/189mbD5+PFOYv+gDQrppSbu3C+cNf\nl/w49t/CPZT8lqVSaAPxs9qJm+JHUEXy7kZvldYlo762wWPzsBhisd5NnkhflhkP\nJIckZ3yyaynGd9be+7okhpTKuI3Qxhy10k1k1sWrbbSYRCnd5jGU7svDAgMBAAGj\nPzA9MA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUH\nAwIwDAYDVR0TAQH/BAIwADANBgkqhkiG9w0BAQsFAAOCAQEAZJKzNHAURBWbkHt5\n60dYLX5xuryOndzLZE59xppu7qt8TerlH7jgRYuRXOT3c2sZHC3ZZRupLYsoCkoo\nZG+r0WCyNJ4Yz6LTXV+rswkD5iKLuKmhGvL99v1xGFoUGsFPnOPBJvgULXi41xe/\nXjffHDhRnjaiXUSdX3tp+CIODpsUO8gMmFKGtMGaayrAU3eex2qWXCda/dL3in9/\n1Bbqd5nIit2A0/NTajQ8Je9V9ls9hPM6v+dI9XevQWaK2Dklqw206YklXmvgQijK\nMJ4mMJRjqMDXBlV8pIKcEH++I2Q3j8zW7yhSnGEc6MliSN3ozdiemyEzJvLGEUfM\nhVtSPw==\n-----END CERTIFICATE-----\n, "key": -----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEA8UpjoDRXslfdgzUZA3+UkX2PV8RRGJUL4Mg62oFGQaqkoT2X\nYBL6RGVDZxIZFWW8PV3tc0C7kJ36w4Q7PMozTtWOcXir7BwVAHStZGj9j1tV0e8a\ngx7x1mgsEGFhvj5ZAlt/OXNJeilhBvSGBF1nTlApRZzr4awO3UuXcsVG0qgcA0R/\nXNlwlePLFin62r3f9fPZmw+fjxTmL/oA0K6aUm7twvnDX5f8OPbfwj2U/JalUmgD\n8bPaiZviR1BF8u5Gb5XWJaO+tsFj87AYYrHeTZ5IX5YZDySHJGd8smspxnfW3vu6\nJIaUyriN0MYctdJNZNbFq220mEQp3eYxlO7LwwIDAQABAoIBAQDHEIwou4YuSHcj\nrEa6sCKt9VyxF/GfyjdGd2q2ojiILHQt4lZkmMOIcdKt0iyHjqtCJZ+kmh8kLHGZ\npBoLCPZTb7RYwSl1XaWl/pyeXk/yWXPwAsdorbrvHHpd+TlebqmYXEwV5ZsVAdZe\nmpWGPFjiLxgdqlygjgalY5vKwB6x4w0vSs7ZQPhBAjM+7kd7eJAEBGeLQ/YQLB/V\n5Bkkr/fOgz+P7WkyAJ/FMbG68+A7gQGy2oXgglul9x9b9dqrCJnMTqd4ComNjNac\nJUjXc0EFxRjN7NGGczxWDEgsWbpc1xZX+m3pD+BtCwpRyrxCsCXl+NYgOMIoQYib\niLPg8l3BAoGBAPPkpLu34SSaARM8MX1lBrGLkI6r9KenLiVMaNyloB1kr3oChBnx\nbzNd2GqisAlBEorUXGd9PZuSjbdF2uqLh/uS/vPA1JfGwkjFDFcrMYWx11XeLs/Q\nf+v1vvd9EJyoL6zB1BHZzVnzqHCl89io4F7ZIw2iJCCcZRb7be9GsnGbAoGBAP1E\nrDwnWP4nW7M0vRXpUdct5POztvHTZh51Ih/w6INC9ZuywxRh2/WLK4fVAD61xYhN\nUGAoSaTC4keghbU/Mf9ikAKw71dOvNGK0Rv4NNVplBVlXarqy8JSxbHrsMSnkI28\n8MgmXvV/6F0e51XYulyXQsjUjBmTWQ53ftVqtaT5AoGBAOoFJhwJIDsimo1+YG5V\nlcqehCKh1KtZuumHG8c8FRqfFdEYwPCzvWOoVJRdblQy4Dvd8JxMi+TPBrQojxom\nsGAwd/ojuNm5mYqBqImrpGUIc/qsqnY1NcmPj6Ghm2L17mjxwy8tseDx71nHoubt\ng/z+lKfsQIYaCtW2g5HoYCipAoGBAM3mpp/A3XjCRqrKlW7a4M4vYZM+59xyIPNi\nBvwwvtb3+PU7v50yccCOBDXJ1QkmfhDxygZiunxYc94Hgqx3VA5r8ug9MFeqi5dP\nY/F5OHrH+rvqTNxHRqAU6uRa2LsH/1073gTaLRkpg58xIKGKMPhVgNYE9mFUiXJZ\nc6PNvR8BAoGAM359YICTjSMbV/J2TmLuf8vz8tYRCyyekHzgkSrjjYFV6j1Q9eXd\nkVEZ+ZamqbFoRlj+YGKmWCL49rSZF16eX/Uw9nahA+rkX/mZhDd9r+TOtzzrqEXI\nTAYewtyda3S92k+NYO3dNdmfKAWXWbsv6T+0AMtzU1d2SZh9lMNZVE0=\n-----END RSA PRIVATE KEY-----\n' --compressed --insecure
