<div class="variables-tab">
  <!-- TODO: RC Arrive from app wall error-->

  <div class="variables-tab__env-table">
    <div>
      <div [class.show]="(envVarsDataSource.isLoadingPage$ | async)" class="variables-tab__env-table__loading">
        <md-progress-bar color="primary" [mode]="'query'"></md-progress-bar>
      </div>
      <md-card>
        <md-card-header [ngClass]="{'selected': (envVarsDataSource.isSelecting$ | async) }">
          <div [hidden]="(envVarsDataSource.isSelecting$ | async) || (envVarsDataSource.isAdding$ | async)">
            <div class="grow-title mat-card-header-text-wa">Environment Variables</div>
            <div [hidden]="paginator.length === 0">
              <form novalidate>
                <md-form-field floatPlaceholder="never">
                  <input mdInput ngModel #filter="ngModel" name="filter" placeholder="Filter Environment Variables">
                </md-form-field>
              </form>
            </div>
            <!-- addRowName.focus() -->
            <button md-icon-button (click)="addRowForm.reset(); envVarsDataSource.startAdd();">
              <md-icon>add</md-icon>
            </button>
          </div>
          <div [hidden]="!(envVarsDataSource.isSelecting$ | async)">
            <div class="grow-title mat-card-header-text-wa">{{envVarsDataSource.selectedRows.size}} Selected</div>
            <button md-icon-button (click)="envVarsDataSource.selectedDelete()">
              <md-icon>delete</md-icon>
            </button>
          </div>
          <div [hidden]="!(envVarsDataSource.isAdding$ | async)">
            <div class="grow-title mat-card-header-text-wa"></div>
            <form #addRowForm="ngForm" novalidate>
              <!-- [appFocus]="envVarsDataSource.addAppFocusEventEmitter"  -->
              !!{{envVarsDataSource.addRow | json}}!!

              <md-form-field floatPlaceholder="never">
                <input mdInput id="envVarName" name="envVarName" #envVarName="ngModel" placeholder="Name" [(ngModel)]="envVarsDataSource.addRow.name"
                  required [appUnique]="envVarsDataSource.rowNames">
                <md-error *ngIf="envVarName.errors && envVarName.errors.required">Name is required</md-error>
                <md-error *ngIf="envVarName.errors && envVarName.errors.appUnique">{{envVarName.errors.appUnique.message}}</md-error>
              </md-form-field>
              <md-form-field floatPlaceholder="never">
                <input mdInput #addRowName id="envVarValue" name="envVarValue" placeholder="Value" [(ngModel)]="envVarsDataSource.addRow.value">
              </md-form-field>
            </form>
            <button md-icon-button (click)="envVarsDataSource.saveAdd()" [disabled]="!addRowForm.valid">
              <md-icon>done</md-icon>
            </button>
            <button md-icon-button (click)="envVarsDataSource.cancelAdd()">
              <md-icon>clear</md-icon>
            </button>
          </div>
        </md-card-header>
        <md-card-content>
          <md-table #table [hidden]="paginator.length === 0" [dataSource]="envVarsDataSource" mdSort>
            <ng-container mdColumnDef="select">
              <md-header-cell *mdHeaderCellDef>
                <md-checkbox [disabled]="(envVarsDataSource.isAdding$ | async)" [checked]="envVarsDataSource.selectAllChecked" (change)="envVarsDataSource.selectAllFilteredRows()">
                </md-checkbox>
              </md-header-cell>
              <md-cell *mdCellDef="let row">
                <md-checkbox [disabled]="(envVarsDataSource.isAdding$ | async)" [checked]="envVarsDataSource.selectedRows.has(row.name)"
                  (change)="envVarsDataSource.selectedRowToggle(row)"></md-checkbox>
              </md-cell>
            </ng-container>
            <ng-container mdColumnDef="name">
              <md-header-cell *mdHeaderCellDef md-sort-header disableClear="true"> Name </md-header-cell>
              <md-cell *mdCellDef="let row">{{row.name}}</md-cell>
            </ng-container>
            <ng-container mdColumnDef="value">
              <md-header-cell *mdHeaderCellDef md-sort-header disableClear="true"> Value </md-header-cell>
              <md-cell *mdCellDef="let row">
                <md-form-field *ngIf="row.name === envVarsDataSource.editRow?.name">
                  <input mdInput name="envVarValue" [value]="envVarsDataSource.editRow?.value" (input)="envVarsDataSource.editRow.value = $event.target.value"
                  />
                </md-form-field>
                <span *ngIf="row.name !== envVarsDataSource.editRow?.name">{{row.value}}</span>
              </md-cell>
            </ng-container>
            <ng-container mdColumnDef="edit">
              <md-header-cell *mdHeaderCellDef>
              </md-header-cell>
              <md-cell *mdCellDef="let row">
                <button md-icon-button *ngIf="row.name !== envVarsDataSource.editRow?.name" (click)="envVarsDataSource.startEdit(row)" [disabled]="(envVarsDataSource.isSelecting$ | async) || (envVarsDataSource.isAdding$ | async)">
                  <md-icon>edit</md-icon>
                </button>
                <button md-icon-button *ngIf="row.name === envVarsDataSource.editRow?.name" (click)="envVarsDataSource.saveEdit()">
                  <md-icon>done</md-icon>
                </button>
                <button md-icon-button *ngIf="row.name === envVarsDataSource.editRow?.name" (click)="envVarsDataSource.cancelEdit()">
                  <md-icon>clear</md-icon>
                </button>
              </md-cell>
            </ng-container>
            <md-header-row [hidden]="paginator.length === 0" *mdHeaderRowDef="['select', 'name', 'value', 'edit']">
            </md-header-row>
            <md-row *mdRowDef="let row; columns: ['select', 'name', 'value', 'edit'];">
            </md-row>
          </md-table>
          <div [hidden]="paginator.length > 0" class="mat-card-header-text no-variables">
            <div class="mat-card-header-text">
              <div class="mat-card-header-text-wa">You have no variables.</div>
            </div>
          </div>
        </md-card-content>
        <md-card-footer>
          !!{{paginator.length }}!!
          <div [hidden]="paginator.length === 0">
            <!-- [pageIndex]="0" [pageSize]="5" [pageSizeOptions]="[5, 10, 25, 100]" [length]="( envVarsDataSource.count$ | async)"-->
            <md-paginator #paginator>
            </md-paginator>
          </div>
        </md-card-footer>
      </md-card>
    </div>
  </div>

  <div class="variables-tab__env-code-block">
    <md-card>
      <md-card-header>Variables</md-card-header>
      <md-card-content>
        <app-code-block>{{ (envVars$ | async)?.metadata | json }}</app-code-block>
      </md-card-content>
    </md-card>
  </div>
</div>
