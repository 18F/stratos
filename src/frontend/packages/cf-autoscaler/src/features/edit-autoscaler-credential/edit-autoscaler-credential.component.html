<app-page-header>
  <h1>Manage AutoScaler Credentials: {{ (applicationService.application$ | async)?.app.entity.name }} </h1>
  <div class="page-header-right">
    <button mat-icon-button mat-button routerLink="{{parentUrl}}">
      <mat-icon>clear</mat-icon>
    </button>
  </div>
</app-page-header>
<div class="autoscaler-credential">
  <app-tile-grid class="app-autoscaler-tile-grid-100">
    <app-tile-group>
      <app-tile>
        <mat-card>
          <mat-card-header>
            <div>
              <p>Credentials are required when submitting custom metrics to the autoscaler. They can either be supplied
                or randomly generated</p>
              <p>Please note, only the latest set of credentials are valid. Creating a new set will invalidate any
                previously created</p>
            </div>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="editCredentialForm" validate class="autoscaler-credential__form">
              <div class="autoscaler-credential__toggle">
                <span>Create random credential</span>
                <mat-slide-toggle [checked]="!randomCredential" (toggleChange)="toggleChange()">Create specified
                  credential
                </mat-slide-toggle>
              </div>
              <mat-form-field>
                <input matInput placeholder="Username" name="acusername" formControlName="acusername" type="text"
                  required>
                <mat-error *ngIf="editCredentialForm.get('acusername').hasError('required')">
                  Username is required
                </mat-error>
              </mat-form-field>
              <mat-form-field>
                <input matInput placeholder="Password" name="acpassword" formControlName="acpassword" type="text"
                  required>
                <mat-error *ngIf="editCredentialForm.get('acpassword').hasError('required')">
                  Password is required
                </mat-error>
              </mat-form-field>
            </form>
            <div class="autoscaler-credential__buttons">
              <button color="accent" mat-button mat-raised-button (click)="createCredential()"
                [disabled]="(!randomCredential && !editCredentialForm.valid) || (creating$ | async)">
                <div class="autoscaler-credential__buttons--spinner">
                  <mat-progress-spinner *ngIf="creating$ | async; else notCreating" diameter="20" mode="indeterminate">
                  </mat-progress-spinner>&nbsp;
                  <ng-template #notCreating>Create</ng-template>
                </div>

              </button>
              <button color="accent" class="autoscaler-credential__button" mat-button mat-raised-button
                (click)="deleteCredentialConfirm()" [disabled]="deleting$ | async">
                <div class="autoscaler-credential__buttons--spinner">
                  <mat-progress-spinner *ngIf="deleting$ | async; else notDeleting" diameter="20" mode="indeterminate">
                  </mat-progress-spinner>&nbsp;
                  <ng-template #notDeleting>Delete</ng-template>
                </div>
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </app-tile>
    </app-tile-group>
    <app-tile-group *ngIf="appAutoscalerCredential$ | async as credential">
      <app-tile>
        <mat-card>
          <mat-card-header>
            <div>
              <p>Credentials have been generated. Please apply them to the process used to create the custom metrics.
                If this is an application's environment variables please restart the application for changes to take
                effect.</p>
              <p>Credentials will only be available to view here once. Please ensure they are recorded correctly</p>
            </div>
          </mat-card-header>
          <mat-card-content>
            <app-code-block>
              <pre>{{ credential | json }}</pre>
            </app-code-block>
          </mat-card-content>
        </mat-card>
      </app-tile>
    </app-tile-group>
  </app-tile-grid>
</div>