<ng-container *ngIf="errorDetails$ | async as errorDetails">
  <app-page-header [hideEndpointErrors]="true">
    <h1>Recent Endpoint Errors</h1>
    <div class="page-header-right">
      <span>
        <button mat-icon-button matTooltip="Close" [routerLink]="back$ | async">
          <mat-icon>close</mat-icon>
        </button>
      </span>
    </div>
  </app-page-header>
  <div class="error-page">
    <div class="error-page__header">
      <div class="error-page__header-left">
        <div class="error-page__endpoint-name-subtitle">Endpoint name</div>
        <h2>{{errorDetails.endpoint.name}}</h2>
      </div>
      <div class="error-page__header-right">
        <a class="error-page__download" *ngIf="errorDetails.errors && errorDetails.errors.length" mat-icon-button
          [href]="jsonDownloadHref$ | async" title="Download endpoint error information" download="endpoint-errors.json"
          matTooltip="Download endpoint error information" aria-label="Download endpoint error information">
          <mat-icon>cloud_download</mat-icon>
        </a>
      </div>
    </div>
    <div class="error-page__errors" *ngIf="errorDetails.errors && errorDetails.errors.length ; else noEvents">
      <span class="error-page__errors-header">
        <button mat-button color="warn" (click)="dismissEndpointErrors(errorDetails.endpoint.guid)">Dismiss
          errors</button>
      </span>
      <mat-list>
        <mat-card class="error-page__event-row-card" *ngFor="let error of errorDetails.errors">
          <mat-card-header>
            <div mat-card-avatar>
              <app-stateful-icon class="error-page__event-row-icon" [state]="icon">
              </app-stateful-icon>
            </div>
            <mat-card-title>{{ error.timestamp | date:'medium' }}</mat-card-title>
          </mat-card-header>
          <div>
            <div class="error-page__event-row">
              <div matLine class="error-page__event-key">Endpoint Response</div>
              <div matLine class="error-page__json-response error-page__event-value error-page__event-message">
                <pre>{{ error.metadata.errorResponse.errorResponse || '-' }}</pre>
              </div>
              <div matLine class="error-page__event-key">Jetstream Response</div>
              <div matLine class="error-page__event-value error-page__event-message">{{ error.message }}</div>
              <div matLine class="error-page__event-key">URL</div>
              <div matLine class="error-page__event-value">{{ error.metadata.url || '-' }}</div>
              <div matLine class="error-page__event-key">HTTP Method</div>
              <div matLine class="error-page__event-value">{{ error.metadata.httpMethod }}</div>
              <div matLine class="error-page__event-key">HTTP Code</div>
              <div matLine class="error-page__event-value">{{ error.eventCode }}</div>
            </div>
          </div>
        </mat-card>
      </mat-list>
    </div>
  </div>
  <ng-template #noEvents>
    <div>No recent errors</div>
  </ng-template>
</ng-container>